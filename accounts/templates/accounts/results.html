<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Staff Assessment Portal | Curriculum Results</title>

    <!-- Prevent the demo from appearing in search engines -->
    <meta name="robots" content="noindex">

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CRoboto:400,500%7CExo+2:600&amp;display=swap" rel="stylesheet">

    <!-- Perfect Scrollbar -->
    <link type="text/css" href="/static/assets/vendor/perfect-scrollbar.css" rel="stylesheet">

    <!-- Fix Footer CSS -->
    <link type="text/css" href="/static/assets/vendor/fix-footer.css" rel="stylesheet">

    <!-- Material Design Icons -->
    <link type="text/css" href="/static/assets/css/material-icons.css" rel="stylesheet">


    <!-- Font Awesome Icons -->
    <link type="text/css" href="/static/assets/css/fontawesome.css" rel="stylesheet">


    <!-- Preloader -->
    <link type="text/css" href="/static/assets/css/preloader.css" rel="stylesheet">


    <!-- App CSS -->
    <link type="text/css" href="/static/assets/css/app.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/morris.js-0.5.1/morris.css" />
    <style>
         #toast{
            visibility: hidden;
            min-width: 250px;
            margin-left: -125px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 2px;
            padding: 16px;
            position: fixed;
            z-index: 1;
            left: 50%;
            bottom: 30px;
            font-size: 14px;
        }
        #toast.show {
            visibility: visible;
            -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }
    </style>





</head>

<body class="layout-sticky-subnav layout-default ">

    <div class="preloader">
        <div class="sk-double-bounce">
            <div class="sk-child sk-double-bounce1"></div>
            <div class="sk-child sk-double-bounce2"></div>
        </div>
    </div>

    <!-- Header Layout -->
    <div class="mdk-header-layout js-mdk-header-layout">

        <!-- Header -->

        <div id="header" class="mdk-header js-mdk-header mb-0" data-fixed data-effects="">
            <div class="mdk-header__content">



            </div>
        </div>

        <!-- // END Header -->

        <!-- Header Layout Content -->
        <div class="mdk-header-layout__content page-content ">

            <div class="page-section" style="background-color: #39409b;margin-bottom: 20px;" >
                <div class="container page__container">
                    <div class="  page-headline--title text-center" style="margin-top: 80px;margin-bottom: 80px; background-color: none;">
                        <a href="/" class="fxt-logo"><img src="/static/assets/img/logo-7.png.jpg" style="width: 150px;font-family: 'Roboto', sans-serif;" alt="Logo"></a>
                    </div>

                    <div class="page-headline--title text-center" style="margin-bottom: 20px;">
                        <h3 class="text-white">Thank You for going through this evaluation.</h3>
                    </div>

                </div>
            </div>

            <div class="page-section">
                <div class="container page__container">
                    <div class="page-headline text-center">
                        <h3>Here are the results.</h3>
                        <p class="lead measure-lead mx-auto text-70" style="font-family: 'Roboto'; font-size: 18px;">The results are calculated as a mean for all the sessions combined</p>
                    </div>
                </div>
            </div>


            <div class=" page-section">
                <div class="container page__container">
                    <div class="row card-group-row">
                        <div class="col-md-4 card-group-row__col">

                            <div class="card card--elevated card-group-row__card">
                                <div class="card-body d-flex">
                                    <!-- <span style="background-color: blue;" class="icon-holder icon-holder--outline-muted rounded-circle d-inline-flex mr-16pt">
                                        <i class="material-icons" ></i>
                                    </span> -->
                                    <div class="flex">
                                        <a class="card-title mb-8pt" href="#">CURRICULUM DESIGN PROCESS</a>
                                        <p class="text-70 mb-0" id="result-A" style="font-size: 17px;">Result goes here</p>
                                    </div>
                                </div>
                                <div class="card-footer d-flex lh-1 px-16pt py-8pt">
                                    <p style="font-size: 17px;color: #0f0d0d;" id="explain-A">Explanation goes here</p>
                                </div>
                            </div>

                        </div>

                         <div class="col-md-4 card-group-row__col">

                            <div class="card card--elevated card-group-row__card">
                                <div class="card-body d-flex">
                                    <!-- <span style="background-color: yellowgreen;" class="icon-holder icon-holder--outline-muted rounded-circle d-inline-flex mr-16pt">
                                        <i class="material-icons"></i>
                                    </span> -->
                                    <div class="flex">
                                        <a class="card-title mb-8pt" href="#">CURRICULUM</a>
                                        <p class="text-70 mb-0" id="result-B" style="font-size: 17px;">Result goes here</p>
                                    </div>
                                </div>
                                <div class="card-footer d-flex lh-1 px-16pt py-8pt">
                                    <p style="font-size: 17px;color: #0f0d0d;" id="explain-B">Explanation goes here</p>
                                </div>
                            </div>

                        </div>
                        <div class="col-md-4 card-group-row__col">

                            <div class="card card--elevated card-group-row__card">
                                <div class="card-body d-flex">
                                    <!-- <span style="background-color: #39409b;" class="icon-holder icon-holder--outline-muted rounded-circle d-inline-flex mr-16pt">
                                        <i class="material-icons"></i>
                                    </span> -->
                                    <div class="flex">
                                        <a class="card-title mb-8pt" href="#">IMPLEMENTATION PROCESS</a>
                                        <p class="text-70 mb-0" id="result-C" style="font-size: 17px;">Result goes here</p>
                                    </div>
                                </div>
                                <div class="card-footer d-flex lh-1 px-16pt py-8pt">
                                    <p style="font-size: 17px;color: #0f0d0d;" id="explain-C">Explanation goes here</p>
                                </div>
                            </div>

                        </div>
                
                    </div>
                </div>
            </div>
            <div id="bar-example"></div>

            <div class=" page-section">
                <div class="container page__container">
                    <div class="row card-group-row">
                        <div class="col-md-12 card-group-row__col">

                            <div class="card card--elevated card-group-row__card">
                                <div class="card-body d-flex">
                                    <!-- <span class="icon-holder icon-holder--outline-muted rounded-circle d-inline-flex mr-16pt"> -->
                                        <i class="material-icons"></i>
                                    </span>
                                    <div class="flex">
                                        <a class="card-title mb-8pt" href="#">TOTAL ACHIEVEMENT</a>
                                        <p class="text-70 mb-0" id="total" style="font-size: 17px;">Result goes here</p>
                                    </div>
                                </div>
                                <div class="card-footer d-flex lh-1 px-16pt py-8pt">
                                    <p style="font-size: 17px;color: rgb(37, 31, 31);" id="explain-total">Explanation goes here</p>
                                </div>
                            </div>

                        </div>                
                    </div>
                </div>
            </div>


            
            <div id="toast"></div>
        </div>
        <!-- // END Header Layout Content -->


        <div class="js-fix-footer2 bg-white border-top-2">
            <div class="container" style="margin-top: 40px;">
                <h2>Evaluator Review Section</h2>
                <form id="evaluation-form" action="#" method="dialog">
                    <div class="col-6">
                        <label>Which institution are you evaluating?</label>
                        <input class="form-control" name="institution" placeholder="Which institution are you evaluating?" required/>
                    </div>
                    <br>
                
                <div class="col-6">
                    <label>Comment on the results obtained</label>
                    <textarea placeholder="Please input your comment about the results" rows="3" name="comment" class="form-control" required></textarea>
                </div>
                <br>
                <div class="col-6">
                    <button id="save-btn" class="btn btn-primary">Submit Results</button>    
                </div>
            </form>
            <br>
            <div class="col-6">
                <p>Evaluated by {{user.first_name}} {{user.last_name}}</p>
            </div>
                
            </div>
            
            <div class="container page__container" style="margin-top: 40px;">
                    <div class="page-headline text-center">
                        <h2>Review your scores</h2>
                        <p class="lead measure-lead mx-auto text-70" style="font-size: 18px;text-align: start;">
                        Ranging between 5 and 4.20 is indicative of an exceptional standard of achievement for the respective indicator, not requiring any amendment.</br>
                        Ranging between 4.19 and 3.40 is indicative of a satisfactory standard of achievement for the respective indicator, not requiring any amendment.</br>
                        Ranging between 3.39 – 2.00 is indicative of poor achievement for the respective indicator, requiring minor corrections. </br>
                        Below 2.00 is indicative of poor achievement for the respective indicator, requiring major corrections.</br>
                        </p>
                    </div>
            </div>
            <div class="container">
                <button class="btn btn-primary" id="print-btn" onclick="myPrint()">Print or Download Page</button>
            </div>
                        
            <div class="container page__container page-section d-flex flex-column">                
                <p class="text-50 small mt-n1 mb-0">Copyright {% now 'Y' %} &copy; All rights reserved.</p>
            </div>
        </div>

            </div>
    <!-- // END Header Layout -->


    <!-- jQuery -->
    <script src="/static/assets/js/jquery.min.js"></script>

    <!-- Bootstrap -->
    <script src="/static/assets/vendor/popper.min.js"></script>
    <script src="/static/assets/vendor/bootstrap.min.js"></script>

    <!-- Perfect Scrollbar -->
    <script src="/static/assets/vendor/perfect-scrollbar.min.js"></script>

    <!-- DOM Factory -->
    <script src="/static/assets/vendor/dom-factory.js"></script>

    <!-- MDK -->
    <script src="/static/assets/vendor/material-design-kit.js"></script>

    <!-- Fix Footer -->
    <script src="/static/assets/vendor/fix-footer.js"></script>

    <!-- App JS -->
    <script src="/static/assets/js/app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
    
    <script src="/static/assets/js/axios.min.js"></script>
      <script src="/static/morris.js-0.5.1/morris.min.js"></script>

    <script>
        function exists(ele){
			if (ele !== null && ele !== undefined){return true}else{return false}
        }

        function scores_to_means(scores){
            var myobj = {};
            var all_scores = {}
            // for(var i=0;i<scores.length;i++){
                for (let [key, value] of Object.entries(scores)) {
                    var num = show_the_numbers(key)
                    var rmvkey = key.replace(num,"");
                    if(exists(myobj[''+rmvkey])){
                        // we update
                        myobj[''+rmvkey] += parseFloat(value);
                        myobj[rmvkey+'-total'] += 1;
                        all_scores[''+rmvkey].push(value)
                    }else{
                        // we start
                        myobj[''+rmvkey] = parseFloat(value);
                        myobj[rmvkey+'-total'] = 1;
                        all_scores[''+rmvkey]=[]
                        all_scores[''+rmvkey].push(value)
                    }
                }
                // console.log(all_scores)
                var means = {}
                for (let [k, v] of Object.entries(myobj)) {
                    var m = (myobj[''+k])/(myobj[k+'-total'])
                    if(!isNaN(m)){
                        means[''+k]=parseFloat(m.toFixed(2));
                    }
                }
                return means
        }
        
        function scores_to_sds(scores){
            var myobj = {};
            var all_scores = {}
            // for(var i=0;i<scores.length;i++){
                for (let [key, value] of Object.entries(scores)) {
                    var num = show_the_numbers(key)
                    var rmvkey = key.replace(num,"");
                    if(exists(myobj[''+rmvkey])){
                        // we update
                        myobj[''+rmvkey] += parseFloat(value);
                        myobj[rmvkey+'-total'] += 1;
                        all_scores[''+rmvkey].push(value)
                    }else{
                        // we start
                        myobj[''+rmvkey] = parseFloat(value);
                        myobj[rmvkey+'-total'] = 1;
                        all_scores[''+rmvkey]=[]
                        all_scores[''+rmvkey].push(value)
                    }
                }
                // console.log(all_scores)
                var means = {}
                for (let [k, v] of Object.entries(myobj)) {
                    var m = (myobj[''+k])/(myobj[k+'-total'])
                    if(!isNaN(m)){
                        means[''+k]=m;
                    }
                }
                var sds = {}
                for (let [n, b] of Object.entries(means)) {
                    // console.log(all_scores[''+n],means[''+n])
                    var sd = SD(all_scores[''+n],means[''+n])
                    sds[''+n]=parseFloat(sd.toFixed(2));
                }
                // console.log(means)
                // now let's for SD
                return sds
            // }
        }
        function SD(scores,mean){
            var all_abs = [];
            for(var i=0;i<scores.length;i++){
                var sc = scores[i];
                var abs = (sc-mean)**2
                all_abs.push(abs);
            }
            var sigma_abs = all_abs.reduce((a, b) => a + b, 0)/(scores.length)
            return Math.sqrt(sigma_abs)
        }


        function show_the_numbers(string){
        return string.match(/[0-9]+/g);
        }
        
        function getExplanation(mean){
            if(mean >= 4.20){
                return `<p style="color:green;">This is indicative of an exceptional standard of achievement for the respective indicator, not requiring any amendment.</p>`
            }
            if(mean >= 3.40 && mean <= 4.19){
                return `<p style="color:blue;">This is indicative of a satisfactory standard of achievement for the respective indicator, not requiring any amendment.</p>`
            }
            if(mean >= 2.00 && mean <= 3.39){
                return `<p style="color:orange;">This is indicative of poor achievement for the respective indicator, requiring minor corrections.</p>`
            }
            if(mean < 2.00){
                return `<p style="color:red;">This is indicative of poor achievement for the respective indicator, requiring major corrections.</p>`
            }
        }
        var results = {}
        var scores = JSON.parse(localStorage.getItem('scores'));
        if(exists(scores)){   
        var finalSds = scores_to_sds(scores);
        var finalMeans = scores_to_means(scores);
        var cur = {
            'A':'CURRICULUM DESIGN PROCESS',
            'B':'CURRICULUM',
            'C':'IMPLEMENTATION PROCESS'
        }
        var mydata = [];
        for (let [m, n] of Object.entries(finalMeans)) {
            var pairs = {}
            pairs['y']=cur[''+m]
            pairs['a']=n
            pairs['b']=finalSds[''+m]
            mydata.push(pairs)
        }
        console.log(mydata)
        // let's save the results right here
        window.results = mydata;
        Morris.Bar({
        element: 'bar-example',
        data: mydata,
        xkey: 'y',
        ykeys: ['a', 'b'],
        labels: ['Mean', 'S.D']
        });
  
        // calculating means now
        for (let [k, l] of Object.entries(finalMeans)) {
            $("#result-"+k).html(`A mean of <strong>${finalMeans[''+k]}</strong>`)
            $("#explain-"+k).html(getExplanation(finalMeans[''+k]))
        }
            var total = 0;
            var count = 0
            for (let [key, value] of Object.entries(finalMeans)) {
                total += value
                count += 1;
            }
            $("#total").html(`You obtained a total mean of <strong>${(total/count).toFixed(2)}</strong> for all three parts`)
            $("#explain-total").html(getExplanation((total/count).toFixed(2)))
            console.log(total)
        }else{
            window.location.href = "/"
        }
function makeRequest(data,url){
    data.user = "{{user.username}}";
   axios.post(url,data)
      .then(function (response) {
        console.log(response);
        if(response.data.success){   
            toast("Results saved successfully!",3000);
            document.getElementById('save-btn').style.display = "none";
        }else{
            toast("Sorry,We could not save results",3000);
        }
      })
      .catch(function (error) {
        toast("Sorry,We could not save results",3000);
        if (exists(error.response)){
              console.log(error.response.data)
          }
      });
}
        function exists(ele){
            if (ele !== null && ele !== undefined){return true}else{return false}
        }
        function myPrint() {
        document.getElementById('print-btn').style.display = "none";
        document.getElementById('save-btn').style.display = "none";
        window.print();
        }
            function toast(msg,time) {
        var x = document.getElementById("toast");
        x.innerHTML = msg;
        x.className = "show";
        setTimeout(function(){ x.className = x.className.replace("show", ""); }, time);
        }
        $('#evaluation-form').on('submit',function(event){
        event.preventDefault();
        toast("Saving results...",3000)
        var form = buildForm("evaluation-form");
        const ddata = window.results;
	var rev = JSON.parse(localStorage.getItem("review")) || [];
        const old = {'objects':ddata,'reviews':rev}
        const tosend = $.extend(old, form)
        makeRequest(tosend,"/accounts/save-results/")
        // post(baseUrl + '/stakes/send-file', form)
        });
        function buildForm(id){
            let myForm = document.getElementById(id);
            let formData = new FormData(myForm);
                //This will build the form from name, value pairs
                var obj = {}
                var all = []
                for(var pair of formData.entries()){
                    var name = pair[0]
                    var val = pair[1]
                    obj[name]=val

                }
                return obj
        }
 
var mapper = {
        5:"Strongly Agree",
        4:"Agree",
        3:"Neutral",
        2:"Disagree",
        1:"Stro 
var answers = JSON.parse(localStorage.getItem("answers")) || {};
var questions = JSON.parse(localStorage.getItem("quests")) || {};
var quest_answers = [];
for (var key in questions) {
	console.log(questions[key])
	console.log(answers[key])
    if (questions.hasOwnProperty(key)) {
	    for(var i=0;i<questions[key].length;i++){
	    var obj = {};
	    obj['section']=key
	    obj['question']=questions[key][i];
	    obj['answer']=mapper[answers[key][i]];
	    obj['strength']=answers[key][i];
	    quest_answers.push(obj);
	    }
        
    }
}
localStorage.setItem("review",JSON.stringify(quest_answers));
console.log(quest_answers);
    </script>


</body>


</html>
